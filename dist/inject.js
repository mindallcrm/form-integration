var p=Object.defineProperty;var d=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable;var m=(e,i,t)=>i in e?p(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,l=(e,i)=>{for(var t in i||(i={}))g.call(i,t)&&m(e,t,i[t]);if(d)for(var t of d(i))h.call(i,t)&&m(e,t,i[t]);return e};var c=(e,i,t)=>new Promise((n,o)=>{var s=a=>{try{f(t.next(a))}catch(u){o(u)}},r=a=>{try{f(t.throw(a))}catch(u){o(u)}},f=a=>a.done?n(a.value):Promise.resolve(a.value).then(s,r);f((t=t.apply(e,i)).next())});const MINDALL_CRM={config:{url:"https://crm.mindall.co/api/api/lead/create/byExternalForm",prevent:!0,formId:"",inputs:{firstname:{},lastname:{},email:{},phone:{},propertyReference:{},notes:{}},meta:{orgId:"",sourceId:"",source:""}},init(e,i){if(!e||!i||!i.inputs){console.error("[Mindall CRM] Plugin is not injected due to missing configuration");return}this.config=this.updateConfig(l({},this.config),i),this.config.meta.orgId=e,window.onload=()=>this.inject()},updateConfig(e,i){for(const t in i){const n=i[t];typeof n=="object"&&!Array.isArray(n)&&n!==null&&!(n instanceof RegExp)?e[t]=this.updateConfig(e[t],n):e[t]=n}return e},inject(){var e;(e=this.config.meta)!=null&&e.sourceId||this.setDefaultSourceId(),console.info("[Mindall CRM] Successfully installed")},setDefaultSourceId(){console.info("[Mindall CRM] Setting Source ID from title: '".concat(document.title,"'")),this.config.meta.sourceId=document.title},apiCall(e){return c(this,null,function*(){return fetch(this.config.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})})},buildUserData(e){const i=["input","select","textarea"].reduce((n,o)=>n.push(...e.querySelectorAll(o))&&n,[]),t={};for(let n in this.config.inputs){const o=this.config.inputs[n];let s=[];if(typeof o=="function"){t[n]=o(e);continue}else o.id?o.id instanceof RegExp?s=i.filter(r=>o.id.test(r.id)):s=i.filter(r=>r.id===o.id):o.name&&(o.name instanceof RegExp?s=i.filter(r=>o.name.test(r.name)):s=i.filter(r=>r.name===o.name));s.length&&(t[n]=s[0].value||null)}for(let n in t)t[n]===null&&delete t[n];return t},buildMetaData(){return this.config.meta},handleFormSubmit(e){return c(this,null,function*(){e.preventDefault();const i=l(l({},this.buildUserData(e.target)),this.buildMetaData());MINDALL_CRM.apiCall(i).then(t=>c(this,null,function*(){if(!t.ok){const n=t.statusText||"Request failed";return Promise.reject(n)}MINDALL_CRM.config.prevent||e.target.submit()})).catch(t=>alert(t))})}};document.addEventListener("submit",e=>{e.target.tagName.toLowerCase()==="form"&&(MINDALL_CRM.config.formId&&MINDALL_CRM.config.formId!==e.target.id||MINDALL_CRM.handleFormSubmit(e))},!0),window.MINDALL_CRM=MINDALL_CRM;
